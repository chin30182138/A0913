<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>六獸六親 一鍵分析</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-800">
  <div class="max-w-4xl mx-auto p-6 space-y-4">
    <h1 class="text-2xl font-bold">六獸六親 一鍵分析（安全版）</h1>

    <div class="grid md:grid-cols-2 gap-4">
      <!-- 我方 -->
      <section class="bg-white p-4 rounded-2xl shadow-sm">
        <h2 class="font-semibold mb-3">我方</h2>
        <select id="aBeast" class="w-full mb-2 border rounded-lg p-2">
          <option value="">六獸</option>
          <option>青龍</option><option>朱雀</option><option>勾陳</option>
          <option>螣蛇</option><option>白虎</option><option>玄武</option>
        </select>
        <select id="aKin" class="w-full border rounded-lg p-2">
          <option value="">六親</option>
          <option>父母</option><option>兄弟</option><option>子孫</option>
          <option>妻財</option><option>官鬼</option>
        </select>
      </section>

      <!-- 對方 -->
      <section class="bg-white p-4 rounded-2xl shadow-sm">
        <h2 class="font-semibold mb-3">對方</h2>
        <select id="bBeast" class="w-full mb-2 border rounded-lg p-2">
          <option value="">六獸</option>
          <option>青龍</option><option>朱雀</option><option>勾陳</option>
          <option>螣蛇</option><option>白虎</option><option>玄武</option>
        </select>
        <select id="bKin" class="w-full border rounded-lg p-2">
          <option value="">六親</option>
          <option>父母</option><option>兄弟</option><option>子孫</option>
          <option>妻財</option><option>官鬼</option>
        </select>
      </section>
    </div>

    <section class="bg-white p-4 rounded-2xl shadow-sm">
      <h2 class="font-semibold mb-2">情境</h2>
      <div class="flex gap-2 flex-wrap mb-2">
        <button class="preset px-3 py-1.5 rounded-full bg-slate-100">年度目標協調</button>
        <button class="preset px-3 py-1.5 rounded-full bg-slate-100">績效回饋會議</button>
        <button class="preset px-3 py-1.5 rounded-full bg-slate-100">跨部門協作</button>
        <button class="preset px-3 py-1.5 rounded-full bg-slate-100">壓期交付專案</button>
      </div>
      <input id="context" class="w-full border rounded-lg p-2" placeholder="輸入情境…" />
    </section>

    <div class="flex gap-3">
      <button id="go" class="px-4 py-2 rounded-xl bg-indigo-600 text-white">一鍵分析</button>
      <span id="status" class="text-sm text-slate-600"></span>
    </div>

    <section class="bg-white p-4 rounded-2xl shadow-sm">
      <h2 class="font-semibold mb-2">結果</h2>
      <pre id="result" class="whitespace-pre-wrap text-sm"></pre>
    </section>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    document.querySelectorAll('.preset').forEach(b=>b.onclick=()=>$('#context').value=b.textContent);

    $('#go').onclick = async () => {
      const payload = {
        aBeast: $('#aBeast').value, aKin: $('#aKin').value,
        bBeast: $('#bBeast').value, bKin: $('#bKin').value,
        context: $('#context').value.trim()
      };
      if (!(payload.aBeast && payload.aKin && payload.bBeast && payload.bKin && payload.context)) {
        alert('請先選滿四個選項並填情境'); return;
      }
      $('#status').textContent = '分析中…';
      $('#result').textContent = '';
      try {
        const res = await fetch('/api/analyze', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        $('#result').textContent = data.text ?? JSON.stringify(data, null, 2);
        $('#status').textContent = '✅ 完成';
      } catch (e) {
        $('#status').textContent = '❌ 失敗';
        $('#result').textContent = String(e);
      }
    };
  </script>
</body>
</html>
